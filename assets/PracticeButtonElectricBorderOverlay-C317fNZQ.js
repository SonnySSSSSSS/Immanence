import{Z as e,at as t,it as n,rt as r,tt as i}from"./index-NOppfZ3u.js";import{n as a,r as o}from"./pickerChannel-BlqIvKQn.js";import{t as s}from"./ElectricBorder-DBbRBp_i.js";var c=t(n(),1),l=r(),u=i(),d=`[data-ui="practice-button"]`,f=16,p=`immanence.dev.practiceButtonFxPicker`,m=`immanence-practice-button-fx-picker`,h={breath:`rgba(52, 211, 153, 1)`,stillness:`rgba(255, 210, 120, 1)`,awareness:`rgba(105, 235, 255, 1)`,visual:`rgba(196, 120, 255, 1)`,sound:`rgba(108, 126, 255, 1)`,integration:`rgba(251, 191, 36, 1)`,circuit:`rgba(168, 85, 247, 1)`};function g(e){if(typeof e!=`string`)return 0;let t=Number.parseFloat(e);return Number.isFinite(t)?t:0}function _(e){if(!(e instanceof Element))return 0;let t=window.getComputedStyle(e);return g(t.borderTopLeftRadius||t.borderRadius||`0`)}function v(e){let t=String(e||``).trim().toLowerCase();return t?t===`perception`?`visual`:t===`resonance`?`sound`:t:null}function y(){if(typeof window>`u`)return{applyToAll:!0,selectedKey:null};try{let e=a(p);return e?{applyToAll:e?.applyToAll!==!1,selectedKey:typeof e?.selectedKey==`string`&&e.selectedKey.length?e.selectedKey:null}:{applyToAll:!0,selectedKey:null}}catch{return{applyToAll:!0,selectedKey:null}}}function b(e){if(!(e instanceof Element))return null;let t=e.matches?.(`[data-ui-fx-surface="true"]`)?e:e.querySelector?.(`[data-ui-fx-surface="true"]`)||e,n=t.getBoundingClientRect();if(!n||n.width<2||n.height<2)return null;let r=_(t),i=v(e.getAttribute(`data-practice-type`)),a=h[i]||h.awareness,o=e.getAttribute(`data-practice-id`)||e.id||i||`practice`;return{key:`${i||`practice`}:${o}`,color:a,rect:{left:n.left,top:n.top,width:n.width,height:n.height},radius:r}}function x(){let t=e(e=>!!e.practiceButtonFxEnabled),n=e(e=>!!e.reduceMotion),[r,i]=(0,c.useState)(()=>y()),[a,p]=(0,c.useState)([]),h=(0,c.useRef)(null),g=(0,c.useRef)(null),_=(0,c.useRef)(!1),v=(0,c.useCallback)(()=>{_.current||(_.current=!0,window.requestAnimationFrame(()=>{if(_.current=!1,!t){p([]);return}let e=Array.from(document.querySelectorAll(d)),n=e.map(b).filter(Boolean);p(!r.applyToAll&&r.selectedKey?n.filter(e=>e.key===r.selectedKey):n),h.current&&(h.current.disconnect(),e.forEach(e=>h.current?.observe(e)))}))},[t,r.applyToAll,r.selectedKey]);(0,c.useEffect)(()=>typeof window>`u`?void 0:o(m,e=>{let t=e?.detail||null;if(!t){i(y()),v();return}i({applyToAll:t.applyToAll!==!1,selectedKey:typeof t.selectedKey==`string`&&t.selectedKey.length?t.selectedKey:null}),v()}),[v]),(0,c.useEffect)(()=>{if(h.current?.disconnect(),h.current=null,g.current?.disconnect(),g.current=null,!t){p([]);return}v(),h.current=typeof ResizeObserver<`u`?new ResizeObserver(()=>v()):null,document.querySelectorAll(d).forEach(e=>h.current?.observe(e)),g.current=typeof MutationObserver<`u`?new MutationObserver(()=>v()):null,g.current?.observe(document.body,{subtree:!0,childList:!0,attributes:!0,attributeFilter:[`data-ui`,`data-practice-type`,`data-practice-id`]});let e=()=>v(),n=()=>v();return window.addEventListener(`scroll`,e,!0),window.addEventListener(`resize`,n),()=>{window.removeEventListener(`scroll`,e,!0),window.removeEventListener(`resize`,n),h.current?.disconnect(),h.current=null,g.current?.disconnect(),g.current=null}},[t,v]);let x=(0,c.useMemo)(()=>{if(!t)return[];let e=n?0:.052;return a.map(t=>{let n=t.rect;return{key:t.key,style:{position:`fixed`,left:`${n.left-f}px`,top:`${n.top-f}px`,width:`${n.width+f*2}px`,height:`${n.height+f*2}px`,pointerEvents:`none`,zIndex:9997},width:n.width+f*2,height:n.height+f*2,innerRect:{x:f,y:f,width:n.width,height:n.height,radius:t.radius},color:t.color,speed:e,chaos:.095}})},[t,n,a]);return!t||x.length===0?null:(0,l.createPortal)((0,u.jsx)(u.Fragment,{children:x.map(e=>(0,u.jsx)(`div`,{"data-dev-overlay":`practice-button-electric-border`,style:e.style,children:(0,u.jsx)(s,{width:e.width,height:e.height,innerRect:e.innerRect,color:e.color,speed:e.speed,chaos:e.chaos,thickness:2,showSparks:!1})},e.key))}),document.body)}var S=x;export{x as PracticeButtonElectricBorderOverlay,S as default};