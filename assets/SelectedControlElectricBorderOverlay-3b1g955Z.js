import{C as e,U as t,Z as n,at as r,it as i,rt as a,tt as o}from"./index-NOppfZ3u.js";import{n as s,r as c}from"./pickerChannel-BlqIvKQn.js";import{c as l,r as u}from"./controlsFxPresets-D9y6oR4b.js";import{t as d}from"./ElectricBorder-DBbRBp_i.js";var f=r(i(),1),p=a(),m=o(),h=`immanence.dev.controlsFxPicker`,g=`immanence-controls-fx-picker`,_=`dev-controls-fx-surface`,v={homeHub:`rgba(255, 210, 120, 1)`,practice:`rgba(105, 235, 255, 1)`,dailyPractice:`rgba(52, 211, 153, 1)`};function y(e){if(typeof e!=`string`)return 0;let t=Number.parseFloat(e);return Number.isFinite(t)?t:0}function b(e){if(!(e instanceof Element))return 0;let t=window.getComputedStyle(e);return y(t.borderTopLeftRadius||t.borderRadius||`0`)}function x(){if(typeof window>`u`)return{selectedId:null};try{let e=s(h);return e?{selectedId:typeof e?.selectedId==`string`&&e.selectedId.length?e.selectedId:null}:{selectedId:null}}catch{return{selectedId:null}}}function S(t,n){if(!(t instanceof Element))return null;let r=e(t);if(!r.ok||!(r.surfaceEl instanceof Element))return null;let i=r.surfaceEl.getBoundingClientRect();if(!i||i.width<2||i.height<2)return null;let a=t.getAttribute(`data-ui-role-group`)||`unknown`,o=n?.color&&String(n.color).trim().length?n.color:v[a]||v.practice;return{key:`${t.getAttribute(`data-ui-id`)||`control`}@${a}`,color:o,rect:{left:i.left,top:i.top,width:i.width,height:i.height},radius:b(r.surfaceEl),preset:n||null}}function C(){let r=n(e=>!!e.controlsElectricBorderEnabled),i=n(e=>!!e.reduceMotion),[a,o]=(0,f.useState)(()=>x()),[s,h]=(0,f.useState)(()=>u(a.selectedId)),[y,b]=(0,f.useState)([]),C=(0,f.useRef)(null),w=(0,f.useRef)(null),T=(0,f.useRef)(!1),E=(0,f.useCallback)(()=>{T.current||(T.current=!0,window.requestAnimationFrame(()=>{if(T.current=!1,!r||!t()||!a.selectedId){b([]);return}let e=u(a.selectedId);h(e);let n=`[data-ui-target="true"][data-ui-id="${CSS.escape(a.selectedId)}"]`,i=Array.from(document.querySelectorAll(n));b(i.map(t=>S(t,e)).filter(Boolean)),C.current&&(C.current.disconnect(),i.forEach(e=>C.current?.observe(e)))}))},[r,a.selectedId]);(0,f.useEffect)(()=>typeof window>`u`?void 0:c(g,e=>{let t=e?.detail||null;if(!t){o(x()),E();return}o({selectedId:typeof t.selectedId==`string`&&t.selectedId.length?t.selectedId:null}),E()}),[E]),(0,f.useEffect)(()=>{if(!(typeof window>`u`))return l(()=>E())},[E]),(0,f.useEffect)(()=>{if(C.current?.disconnect(),C.current=null,w.current?.disconnect(),w.current=null,!r||!t()||!a.selectedId){b([]);return}E(),C.current=typeof ResizeObserver<`u`?new ResizeObserver(()=>E()):null;let e=`[data-ui-target="true"][data-ui-id="${CSS.escape(a.selectedId)}"]`;document.querySelectorAll(e).forEach(e=>C.current?.observe(e)),w.current=typeof MutationObserver<`u`?new MutationObserver(()=>E()):null,w.current?.observe(document.body,{subtree:!0,childList:!0,attributes:!0,attributeFilter:[`data-ui-target`,`data-ui-id`,`data-ui-role-group`,`data-ui-fx-surface`]});let n=()=>E(),i=()=>E();return window.addEventListener(`scroll`,n,!0),window.addEventListener(`resize`,i),()=>{window.removeEventListener(`scroll`,n,!0),window.removeEventListener(`resize`,i),C.current?.disconnect(),C.current=null,w.current?.disconnect(),w.current=null}},[r,a.selectedId,E]);let D=(0,f.useMemo)(()=>{if(!r||!t())return[];let e=i?0:s?.speed??.052,n=s?.chaos??.095,a=s?.thickness??2,o=s?.offsetPx??16;return y.map(t=>{let r=t.rect;return{key:t.key,style:{position:`fixed`,left:`${r.left-o}px`,top:`${r.top-o}px`,width:`${r.width+o*2}px`,height:`${r.height+o*2}px`,pointerEvents:`none`,zIndex:9997},width:r.width+o*2,height:r.height+o*2,innerRect:{x:o,y:o,width:r.width,height:r.height,radius:t.radius},color:t.color,speed:e,chaos:n,thickness:a}})},[r,i,s,y]);return(0,f.useEffect)(()=>{if(typeof window>`u`)return;let n=new Set;if(r&&t()&&a.selectedId){let t=`[data-ui-target="true"][data-ui-id="${CSS.escape(a.selectedId)}"]`,r=Array.from(document.querySelectorAll(t));for(let t of r){let r=e(t),i=r.ok&&r.surfaceEl instanceof Element?r.surfaceEl:null;if(!i)continue;n.add(i);let a=s?.color&&String(s.color).trim().length?s.color:v[t.getAttribute(`data-ui-role-group`)||`unknown`]||v.practice;i.classList.add(_),i.style.setProperty(`--dev-controls-fx-glow`,`${Number(s?.glow??18)}px`),i.style.setProperty(`--dev-controls-fx-blur`,`${Number(s?.blur??6)}px`),i.style.setProperty(`--dev-controls-fx-opacity`,`${Number(s?.opacity??1)}`),i.style.setProperty(`--dev-controls-fx-color`,a)}}return()=>{n.forEach(e=>{e.classList.remove(_),e.style.removeProperty(`--dev-controls-fx-glow`),e.style.removeProperty(`--dev-controls-fx-blur`),e.style.removeProperty(`--dev-controls-fx-opacity`),e.style.removeProperty(`--dev-controls-fx-color`)})}},[r,a.selectedId,s]),!r||!t()||D.length===0?null:(0,p.createPortal)((0,m.jsx)(m.Fragment,{children:D.map(e=>(0,m.jsx)(`div`,{"data-dev-overlay":`selected-control-electric-border`,style:e.style,children:(0,m.jsx)(d,{width:e.width,height:e.height,innerRect:e.innerRect,color:e.color,speed:e.speed,chaos:e.chaos,thickness:e.thickness,showSparks:!1})},e.key))}),document.body)}var w=C;export{C as SelectedControlElectricBorderOverlay,w as default};