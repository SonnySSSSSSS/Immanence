.avatar-v3 {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  pointer-events: auto;
  filter: drop-shadow(0 24px 50px rgba(0, 0, 0, 0.35));
}

.avatar-v3--hearth {
  width: min(64vw, 260px);
  height: min(64vw, 260px);
}

.avatar-v3--sanctuary {
  width: min(56vw, 320px);
  height: min(56vw, 320px);
}

.avatar-v3__drift {
  position: relative;
  width: 100%;
  height: 100%;
  animation: avatar-v3-drift var(--avatar-v3-drift-duration, 90s) linear infinite;
}

.avatar-v3__presence {
  position: relative;
  width: 100%;
  height: 100%;
  animation: avatar-v3-breath var(--avatar-v3-breath-duration, 16s) linear infinite;
}

.avatar-v3__presence--settle {
  animation:
    avatar-v3-breath var(--avatar-v3-breath-duration, 16s) linear infinite,
    avatar-v3-settle 2s ease-out 1;
}

.avatar-v3__stack {
  position: relative;
  width: 100%;
  height: 100%;
}

.avatar-v3__layer {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  overflow: hidden;
  pointer-events: none;
}

.avatar-v3__field {
  mix-blend-mode: screen;
  opacity: 0.22;
  filter: saturate(0.55);
}

.avatar-v3__field-drift {
  animation: avatar-v3-field-drift 90s linear infinite;
}

.avatar-v3__stage {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter: grayscale(1) contrast(1.1) brightness(0.98);
  opacity: 0.98;
}

.avatar-v3__stage-layer {
  position: absolute;
  inset: 0;
  transition: opacity 1.4s ease;
}

.avatar-v3__vignette {
  background: radial-gradient(circle at center, rgba(0,0,0,0) 52%, rgba(0,0,0,0.5) 100%);
  mix-blend-mode: multiply;
  opacity: 0.6;
}

.avatar-v3__lens {
  mix-blend-mode: screen;
  opacity: 0.16;
  filter: blur(1.5px);
  animation: avatar-v3-lens-drift var(--avatar-v3-lens-duration, 70s) linear infinite;
}

.avatar-v3__frame {
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.16);
  box-shadow:
    inset 0 0 28px rgba(0, 0, 0, 0.5),
    0 0 22px rgba(255, 255, 255, 0.08);
  background: radial-gradient(circle at center, rgba(255,255,255,0) 60%, rgba(255,255,255,0.08) 70%, rgba(0,0,0,0.35) 100%);
  mix-blend-mode: screen;
}

.avatar-v3__core-bed {
  background: radial-gradient(circle at 50% 40%, rgba(10, 18, 26, 0.65) 0%, rgba(5, 8, 12, 0.95) 80%);
  opacity: 0.85;
}

.avatar-v3__glass {
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.22);
  box-shadow:
    inset 0 0 50px rgba(255, 255, 255, 0.12),
    inset 0 0 18px rgba(255, 255, 255, 0.18),
    0 12px 30px rgba(0, 0, 0, 0.35);
  background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.24), rgba(255,255,255,0) 58%);
  mix-blend-mode: screen;
  opacity: 0.55;
}

.avatar-v3__sigil {
  opacity: 0.55;
  mix-blend-mode: screen;
  filter: drop-shadow(0 0 8px rgba(230, 220, 200, 0.25));
}

.avatar-v3__sigil-image {
  width: 100%;
  height: 100%;
  display: block;
  opacity: 0.9;
  filter: drop-shadow(0 8px 20px rgba(0, 0, 0, 0.35));
}

.avatar-v3__glass-image {
  width: 100%;
  height: 100%;
  display: block;
  opacity: 0.9;
  filter: drop-shadow(0 0 14px rgba(255,255,255,0.2));
}

.avatar-v3__frame {
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.2);
  box-shadow:
    inset 0 0 35px rgba(0, 0, 0, 0.55),
    0 0 26px rgba(255, 255, 255, 0.1);
  background: radial-gradient(circle at center, rgba(255,255,255,0) 58%, rgba(255,255,255,0.1) 70%, rgba(0,0,0,0.45) 100%);
}

.avatar-v3__grain {
  opacity: 0.18;
  mix-blend-mode: soft-light;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='2' seed='12'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.35'/%3E%3C/svg%3E");
  background-size: 220px 220px;
}

.avatar-v3__ripple {
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.35);
  opacity: 0;
  animation: avatar-v3-ripple 1.4s ease-out 1;
}

@keyframes avatar-v3-breath {
  0% { opacity: var(--avatar-v3-breath-min, 0.94); }
  20% { opacity: calc(var(--avatar-v3-breath-min, 0.94) + 0.02); }
  50% { opacity: var(--avatar-v3-breath-max, 1); }
  80% { opacity: calc(var(--avatar-v3-breath-min, 0.94) + 0.02); }
  100% { opacity: var(--avatar-v3-breath-min, 0.94); }
}

@keyframes avatar-v3-settle {
  0% { opacity: 1; }
  45% { opacity: 0.965; }
  100% { opacity: 1; }
}

@keyframes avatar-v3-drift {
  0% { transform: translate(0px, 0px); }
  17% { transform: translate(0.6px, 0.2px); }
  43% { transform: translate(1px, 0.8px); }
  68% { transform: translate(0.4px, -0.6px); }
  100% { transform: translate(0px, 0px); }
}

@keyframes avatar-v3-field-drift {
  0% { transform: translate(0%, 0%); }
  50% { transform: translate(2%, -1%); }
  100% { transform: translate(0%, 0%); }
}

@keyframes avatar-v3-lens-drift {
  0% { transform: translate(-18%, -12%); opacity: 0.08; }
  45% { transform: translate(16%, 10%); opacity: 0.14; }
  100% { transform: translate(-18%, -12%); opacity: 0.08; }
}

@keyframes avatar-v3-ripple {
  0% { transform: scale(0.96); opacity: 0.0; }
  35% { opacity: 0.3; }
  100% { transform: scale(1.05); opacity: 0; }
}
