# TASK-2026-01-05-D: Hearth Small-iPhone Menu Fit (No Clipping)

**Created:** 2026-01-05
**Recommended Executor:** Antigravity (UI/layout fixes)
**Scope:** All menu surfaces at 320px width (iPhone SE class)
**Goal:** Ensure all menu items fully visible/readable without clipping or horizontal overflow

---

## Summary

**Problem:** Multiple menu surfaces have items cut off (text and/or cards) in Hearth mode at small-iPhone widths (320px). This is a systemic pattern issue, not isolated bugs.

**Objective:** Audit and fix ALL menu-like UI surfaces to ensure:

- No text truncation before 2-line clamp
- No vertical clipping of cards/buttons
- No horizontal overflow requiring scrolling
- Visual parity maintained at larger widths (375px, 390px, desktop)

**Scope:** Menu surfaces only - see "Menu Definition" below for exact boundaries

**Strategy:** Pattern-based guardrails, not one-off fixes

---

## Menu Definition (Strict Scope Gate)

**A "menu surface" is any UI that presents a set of choices for navigation or mode selection:**

- Grid or list of selectable items (cards, buttons, chips)
- Action sheets, selectors, drawers, bottom sheets with selectable options
- **Excludes content viewers** (e.g., VideoPlayer) **unless** they contain a selectable menu grid/list

**Scope Rule:** If a listed component is NOT a menu surface by this definition, it is **out of scope** for TASK-2026-01-05-D and should be moved to a separate task.

---

**INCLUDED in scope:**

- Home Hub card swiper (navigation menu)
- Practice type selector grid (choose practice)
- Path selection grid (choose path)
- Program cards grid (choose program)
- Four Modes grid (choose mode)
- Time slot picker grid (choose time)
- Cycle choice options (choose cycle type)

**EXCLUDED from scope (NOT menus):**

- **Practice session screens** - BreathingRing, Vipassana, Cymatics (not menus, they're practice UI)
- **Content viewers** - VideoPlayer video playback, CodexChamber article reader (not selection grids)
- **Forms and inputs** - Text fields, sliders, toggles (separate accessibility task)
- **Stats displays** - CompactStatsCard, DailyPracticeCard data sections (not interactive menus)
- **Modals without selection grids** - Completion reports, journals, single-action dialogs

**Rule of Thumb:** If the UI's primary purpose is "select one option from many," it's a menu. If it's "view content," "practice," or "display data," it's NOT a menu.

**When in doubt:** ASK. Do not expand scope without user confirmation.

---

## Non-Negotiable Constraints

These are **absolute constraints** that must be followed for all menu fixes:

1. **NO items may be hidden, removed, or conditionally not rendered** to "solve" clipping.

   - Solution must make items visible, not remove them

2. **If the menu has an "active" item, it must remain visible.**

   - Active state is conveyed by highlight/badge only
   - Never hide or collapse active menu items

3. **No new scroll areas inside a menu grid** unless explicitly unavoidable.
   - Default: Grid reflows; the page scrolls
   - Do not add `overflow-y-auto` to menu containers to "fix" clipping
   - Menu items should wrap/reflow naturally

---

## Audit Plan

### Step 1: Identify All Menu Surfaces

**Search Strategy:**

1. **UI String Search** - Find menu components by searching for common patterns:

   - "Select your", "Choose", "Explore", "Browse"
   - Grid/card navigation labels
   - Modal titles with options below

2. **Component Search** - Locate reusable menu components:

   ```bash
   grep -r "grid grid-cols" src/components --include="*.jsx"
   grep -r "GridCard\|ButtonGrid\|OptionGrid" src/components --include="*.jsx"
   grep -r "CardSwiper\|MenuCard" src/components --include="*.jsx"
   ```

3. **Route Scanning** - Test each section at 320px:
   - Home Hub (navigation cards)
   - Application Section (mode grid, tracking UI)
   - Practice Section (practice type selector, config options)
   - Wisdom Section (codex browse, video grid)
   - Navigation Section (path grid, program cards)

### Step 2: Reproduce Failures

**Test Environment:**

- Viewport: 320px width (iPhone SE)
- Display mode: Both Hearth and Sanctuary
- Color scheme: Both light and dark

**Inspection Method:**

```javascript
// Chrome DevTools Console
document.querySelectorAll('[class*="grid"]').forEach((el) => {
  if (el.scrollWidth > el.clientWidth) {
    console.warn("Horizontal overflow:", el);
  }
  if (
    el.scrollHeight > el.clientHeight &&
    !el.classList.contains("overflow-y-auto")
  ) {
    console.warn("Vertical clipping:", el);
  }
});

// Check text truncation
document
  .querySelectorAll('h3, h4, .menu-title, [class*="title"]')
  .forEach((el) => {
    if (el.scrollWidth > el.clientWidth) {
      console.warn("Text overflow:", el.textContent, el);
    }
  });
```

### Step 3: Document Each Failure

Use Audit Table Template (below) for each discovered issue.

---

## Audit Table Template

| Route/Screen | Component + File Path             | Failure Mode              | Suspected Cause                        | Proposed Guardrail Fix                                | Proof                                                                                                                                                       |
| ------------ | --------------------------------- | ------------------------- | -------------------------------------- | ----------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Home Hub     | `HomeHub.jsx` (L265)              | Horizontal overflow       | Layered 430px max-width constraints    | Pattern 6: `max-w-[min(430px,94vw)]`                  | [home_hub](file:///C:/Users/trinh/.gemini/antigravity/brain/eafea27d-4191-415e-b642-9085fdffa5ca/home_hub_320px_1767599655045.png)                          |
| Navigation   | `PathSelectionGrid.jsx` (L59)     | Text truncation / Cramped | `grid-cols-3` leaves ~100px per card   | Pattern 1: `grid-cols-2` at ≤360px                    | [nav_grid](file:///C:/Users/trinh/.gemini/antigravity/brain/eafea27d-4191-415e-b642-9085fdffa5ca/navigation_path_grid_320px_1767599708218.png)              |
| Application  | `FourModesHome.jsx` (L238)        | Horizontal overflow       | Horizontal chain of 4 items            | Pattern 1: **2x2 grid** fallback @ 320px              | [apps_chain](file:///C:/Users/trinh/.gemini/antigravity/brain/eafea27d-4191-415e-b642-9085fdffa5ca/application_transmutation_chain_320px_1767599337214.png) |
| Practice     | `PracticeSection.jsx` (L1453)     | Horizontal overflow       | Type switcher flex without shrink      | Package A: `grid-cols-2` @ 320px + `min-w-0`          | [practice_sel](file:///C:/Users/trinh/.gemini/antigravity/brain/eafea27d-4191-415e-b642-9085fdffa5ca/practice_screen_320px_1767599748034.png)               |
| Wisdom       | `WisdomSection.jsx` (L412, L473)  | Text truncation           | `PartAccordion` titles too long        | Package B: `line-clamp-2` for Part/Chap titles        | [wisdom_tr](file:///C:/Users/trinh/.gemini/antigravity/brain/eafea27d-4191-415e-b642-9085fdffa5ca/wisdom_videos_320px_1767599838777.png)                    |
| Wisdom       | `WisdomSection.jsx` (L773)        | Clipping / Overflow       | `Compass` container fixed at 320px     | Pattern 6: `max-w-[min(320px,100vw)]` + radial reflow | [wisdom_comp](file:///C:/Users/trinh/.gemini/antigravity/brain/eafea27d-4191-415e-b642-9085fdffa5ca/wisdom_videos_320px_1767599838777.png)                  |
| Wisdom       | `VideoLibrary.jsx` (L157, L188)   | Text truncation           | `VideoToken` titles too long           | Package B: `line-clamp-2` for token titles            | [wisdom_vid](file:///C:/Users/trinh/.gemini/antigravity/brain/eafea27d-4191-415e-b642-9085fdffa5ca/wisdom_videos_320px_1767599838777.png)                   |
| Modals       | `CurriculumOnboarding.jsx` (L257) | Horizontal overflow       | `grid-cols-4` too tight for time slots | Pattern 1: **2x2 grid** stack @ 320px + `min-w-0`     | [modal_time](file:///C:/Users/trinh/.gemini/antigravity/brain/eafea27d-4191-415e-b642-9085fdffa5ca/onboarding_modal_320px_1767599928640.png)                |
| _Practice_   | `PracticeSection.jsx` (L1360)     | **[OUT-OF-SCOPE]**        | Form inputs (sliders/config)           | Move to accessibility/input task                      | N/A                                                                                                                                                         |
| _Dev_        | `DevPanel.jsx`                    | **[OUT-OF-SCOPE]**        | Developer diagnostic panel             | Excluded from menu audit                              | N/A                                                                                                                                                         |

**Instructions:**

1. Fill one row per discovered failure
2. Include exact file path and line numbers if possible
3. Classify failure mode (see Pattern Classification below)
4. Map to a guardrail pattern, not a one-off fix

---

## Phase 2: Pattern Mapping

Grouped identified failures from Phase 1 into their corresponding guardrail patterns for systematic fixing.

### Pattern 1: Rigid Grid Columns / Reflow Needed

_Failures caused by fixed column counts (grid-cols-3+) or horizontal layouts that refuse to wrap._

- [ ] **Navigation** (`PathSelectionGrid.jsx:L59`): 3-column grid needs 2-column fallback @ 320px.
- [ ] **Application** (`FourModesHome.jsx:L238`): Horizontal chain needs **2x2 grid** fallback @ < 360px.
- [ ] **Practice** (`PracticeSection.jsx:L1453`): Multi-column type switcher needs **2-col grid** fallback @ 320px.
- [ ] **Modals** (`CurriculumOnboarding.jsx:L257`): Time slot grid needs **2-col** fallback @ 320px.

### Pattern 2: Content Wrap / Multi-line Clamp

_Failures where titles truncate or overflow because multi-line wrapping is blocked._

- [ ] **Wisdom** (`WisdomSection.jsx:L412, L473`): Treatise Part/Chapter titles need `line-clamp-2`.
- [ ] **Wisdom** (`VideoLibrary.jsx:L157, L188`): Horizontal band token titles need `line-clamp-2`.

### Pattern 4: Dynamic Text Rule (min-width: 0)

_Failures where flex items overflow because they cannot shrink below intrinsic content width._

- [ ] **Modals** (`CurriculumOnboarding.jsx:L257`): Time slot buttons need `min-w-0` to allow shrink/wrap.

### Pattern 6: Hearth Max-Width Standard

_Failures where absolute `px` widths exceed the 320px viewport._

- [ ] **Home Hub** (`HubCardSwiper.jsx:L44`): 430px swiper container width exceeds 320px; needs `min(430px, 94vw)`.
- [ ] **Home Hub** (`HomeHub.jsx:L265`): 430px card card wrapper width exceeds 320px; needs `min(430px, 94vw)`.
- [ ] **Wisdom** (`WisdomSection.jsx:L773`): 320px compass container clips; needs radial reflow formula.

---

_Failures where absolute `px` widths exceed the 320px viewport._

- [ ] **Home Hub** (`HomeHub.jsx:L265`): 430px card width exceeds viewport.
- [ ] **Wisdom** (`WisdomSection.jsx:L773`): 320px compass container clips when margins/padding considered.

---

---

## Pattern Classification

### Pattern 1: Rigid Grid Columns

**Cause:** `grid-cols-3` or `grid-cols-4` at narrow widths forces cards too small

**Examples:**

- Path selection grid (3 columns on 320px = ~100px per card)
- Practice type selector (4 columns = ~75px per card)

**Solution Pattern:**

```jsx
// Before
<div className="grid grid-cols-3 gap-4">

// After
<div className="grid grid-cols-2 sm:grid-cols-3 gap-4">
// Or responsive:
<div className="grid gap-4" style={{
  gridTemplateColumns: 'repeat(auto-fit, minmax(140px, 1fr))'
}}>
```

**Guardrail:** Default to 2 columns at ≤360px unless cards proven safe at 3+

---

### Pattern 2: Text Truncation Before Wrap

**Cause:** `whitespace-nowrap`, `truncate`, or single-line assumptions on multi-word titles

**Examples:**

- "Breath & Stillness" → "Breath..." on narrow button
- "Thought Detachment Ritual" → "Thought Det..."

**Solution Pattern:**

```jsx
// Before
<h3 className="text-sm font-medium truncate">

// After
<h3 className="text-sm font-medium line-clamp-2">
// Or with Tailwind:
<h3 className="text-sm font-medium overflow-hidden text-ellipsis"
    style={{
      display: '-webkit-box',
      WebkitLineClamp: 2,
      WebkitBoxOrient: 'vertical'
    }}>
```

**Guardrail:** Use 2-line clamp for menu titles; reserve `truncate` for single-word labels only

---

### Pattern 3: Fixed Card Heights

**Cause:** Fixed `h-32`, `h-40` assumes single-line title, breaks when text wraps

**Examples:**

- Program cards with `h-32` but title wraps to 2 lines → description clipped
- Mode buttons with `h-24` → icon pushed down, text cut

**Solution Pattern:**

```jsx
// Before
<div className="h-32 p-4">
  <h3>{title}</h3>
  <p>{description}</p>
</div>

// After
<div className="min-h-32 p-4"> {/* or remove height entirely */}
  <h3>{title}</h3>
  <p>{description}</p>
</div>
```

**Guardrail:** Use `min-height` for cards, let content determine height. Only use fixed height when content is guaranteed single-line.

---

### Pattern 4: Missing `min-width: 0`

**Cause:** Flex/grid children don't shrink below intrinsic content width

**Examples:**

- Long button text prevents grid cell from shrinking
- Flex row with text overflows container

**Solution Pattern:**

```jsx
// Before
<div className="flex gap-2">
  <button className="px-4 py-2">{longText}</button>
</div>

// After
<div className="flex gap-2">
  <button className="px-4 py-2 min-w-0">{longText}</button>
</div>
```

**Guardrail:** Add `min-w-0` to flex/grid children with dynamic text content

---

### Pattern 5: Missing Safe-Area Padding

**Cause:** Bottom menus don't account for home indicator on iPhone X+

**Examples:**

- Bottom action bar overlaps home indicator
- Fixed bottom nav cards cut off at bottom

**Solution Pattern:**

```jsx
// Before
<div className="fixed bottom-0 pb-4">

// After
<div className="fixed bottom-0 pb-safe-4">
// Or inline:
<div className="fixed bottom-0" style={{
  paddingBottom: 'max(1rem, env(safe-area-inset-bottom))'
}}>
```

**Guardrail:** All bottom-fixed/sticky menus must use `safe-area-inset-bottom`

---

### Pattern 6: Fixed Width Cards

**Cause:** Absolute px widths (430px, 600px) don't scale to narrow viewports

**Examples:**

- Card swiper with `maxWidth: 430px` causes horizontal overflow at 320px
- Modal with `width: 500px` requires horizontal scroll

**Solution Pattern:**

```jsx
// Before
<div style={{ maxWidth: '430px' }}>

// After
<div style={{ maxWidth: 'min(430px, 90vw)' }}>
// Or responsive:
<div className="max-w-[90vw] sm:max-w-[430px]">
```

**Guardrail:** Use `min(Xpx, 90vw)` for card widths, or responsive breakpoints

---

## Guardrail Packages (Operational Rules)

These are **named bundles** that implementers can apply consistently across components.

**Mental Model for Implementers:**

- Apply **Package A** to the container (grid/flex that holds menu items)
- Apply **Package B** to titles/labels within each menu item
- This gives a repeatable pattern: "Container gets A, titles get B"

---

### Guardrail Package A: Menu Grid Container

**Purpose:** Prevent overflow and ensure proper reflow at narrow widths

**Application:** Use on the grid/flex container that holds menu items

**Rules:**

1. Use `minmax` columns or responsive breakpoints (prevents overflow)
2. **Breakpoint rule:** ≤360px defaults to 2 columns (unless icon-only)
3. Ensure children can shrink with `min-width: 0` expectation
4. No fixed widths on container (use viewport-relative: `min(Xpx, 90vw)`)

**Implementation Example:**

```jsx
{
  /* GUARDRAIL PACKAGE A: Menu Grid Container */
}
<div
  className="grid grid-cols-2 sm:grid-cols-3 gap-4"
  style={{ maxWidth: "min(600px, 90vw)", margin: "0 auto" }}
>
  {menuItems.map((item) => (
    <div key={item.id} className="min-w-0">
      {/* Package B applies to title here */}
    </div>
  ))}
</div>;
```

**When to Apply:** Every menu surface with a grid/flex layout of selectable items

---

### Guardrail Package B: Menu Item Title

**Purpose:** Ensure titles are readable without clipping or awkward truncation

**Application:** Use on the title/label element within each menu item

**Rules:**

1. **Default behavior:** Wrap to 2 lines (`line-clamp-2`)
2. **Only allow single-line truncation** if explicitly labeled "intentional single-line" in component props/spec notes
3. Avoid fixed heights that assume 1-line titles; use content-driven height (`min-height` not `height`)
4. Text must have room to breathe: ensure parent has `min-width: 0` if in flex/grid

**Implementation Example:**

```jsx
{
  /* GUARDRAIL PACKAGE B: Menu Item Title */
}
<div className="min-h-32 p-4">
  {" "}
  {/* min-height, not fixed height */}
  <h3 className="line-clamp-2 text-sm font-medium">{item.title}</h3>
  <p className="line-clamp-3 text-xs">{item.description}</p>
</div>;
```

**When to Apply:** Every menu item title, button label, or card heading

---

## Guardrails (Menu-Safe Rules)

### Rule 1: Responsive Grid Columns

**Default:** 2 columns at ≤360px, 3 columns at >360px (unless cards proven safe)

**Implementation:**

```jsx
// Option A: Tailwind breakpoints
<div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">

// Option B: CSS Grid auto-fit
<div className="grid gap-4" style={{
  gridTemplateColumns: 'repeat(auto-fit, minmax(140px, 1fr))'
}}>

// Option C: Conditional render
const cols = width <= 360 ? 2 : width <= 640 ? 3 : 4;
<div className="grid gap-4" style={{ gridTemplateColumns: `repeat(${cols}, 1fr)` }}>
```

**Exceptions:** Single-column lists (no grid), icon-only grids (can be 4+)

---

### Rule 2: Text Wrap Before Truncate

**Default:** Menu titles use 2-line clamp, not single-line truncate

**Implementation:**

```jsx
// Menu card titles
<h3 className="line-clamp-2 text-sm font-medium">
  {title}
</h3>

// If Tailwind line-clamp not available:
<h3 className="overflow-hidden" style={{
  display: '-webkit-box',
  WebkitLineClamp: 2,
  WebkitBoxOrient: 'vertical'
}}>
  {title}
</h3>
```

**Exceptions:** Single-word labels (e.g., "Home", "Back"), breadcrumbs

---

### Rule 3: Content-Driven Heights

**Default:** Use `min-height` not `height` for cards with variable text

**Implementation:**

```jsx
// Card with title + description
<div className="min-h-32 p-4">  {/* not h-32 */}
  <h3 className="line-clamp-2">{title}</h3>
  <p className="line-clamp-3">{description}</p>
</div>

// Alternative: No height constraint, let content dictate
<div className="p-4">
  <h3 className="line-clamp-2">{title}</h3>
  <p className="line-clamp-3">{description}</p>
</div>
```

**Exceptions:** Icon-only cards, avatar cards, placeholder cards

---

### Rule 4: min-width: 0 for Flex Children

**Default:** Add `min-w-0` to flex/grid children with text content

**Implementation:**

```jsx
// Flex row with buttons
<div className="flex gap-2">
  <button className="px-4 py-2 min-w-0 flex-1">
    Long Button Text Here
  </button>
</div>

// Grid with cards
<div className="grid grid-cols-2 gap-4">
  <div className="min-w-0 p-4">
    <h3 className="line-clamp-2">Title</h3>
  </div>
</div>
```

**Exceptions:** Fixed-width elements (icons, avatars), elements with explicit width

---

### Rule 5: Safe-Area Bottom Padding

**Default:** Bottom menus/navs must account for home indicator

**Implementation:**

```jsx
// Bottom fixed menu
<div className="fixed bottom-0 left-0 right-0" style={{
  paddingBottom: 'max(1rem, env(safe-area-inset-bottom))'
}}>
  {/* menu content */}
</div>

// Bottom sticky section
<div className="sticky bottom-0" style={{
  paddingBottom: 'calc(1rem + env(safe-area-inset-bottom))'
}}>
  {/* action buttons */}
</div>
```

**Where to apply:** Any element with `fixed bottom-0`, `sticky bottom-0`, or absolute positioning near viewport bottom

---

### Rule 6: Hearth Menu Max Width Standard

**Default:** Menu containers use `maxWidth: min(430px, 94vw)` in Hearth.

**Implementation:**

```jsx
// Swiper or Card wrapper
<div style={{
  maxWidth: 'min(430px, 94vw)',
  margin: '0 auto'
}}>
```

**Exceptions:** Full-width components, elements inside constrained containers

---

### Rule 7: Dynamic Text Rule (min-width: 0)

**Default:** Apply `min-width: 0` on flex/grid children that contain dynamic text to allow shrinking/wrapping.

**Implementation:**

```jsx
// Grid cell with long title
<div className="grid grid-cols-2 gap-4">
  <div className="min-w-0">
    <h3 className="line-clamp-2">{dynamicTitle}</h3>
  </div>
</div>
```

---

## Known Menu Surfaces (Audit Targets)

### Home Hub

- **Component:** `HomeHub.jsx` - Card swiper with navigation cards
- **Likely Issues:** Fixed 430px width, 3-column grid assumptions
- **Check:** Lines ~40-80 (card container), ~200-250 (swiper config)

### Application Section

- **Component:** `FourModesHome.jsx` - 2x2 mode selection grid
- **Likely Issues:** Fixed button heights, text truncation on mode names
- **Check:** Lines ~50-150 (grid layout), ~100-120 (button cards)

- **Component:** `TrackingView.jsx` - Gesture compass, trace log
- **Likely Issues:** Compass buttons too narrow, log entries clipped
- **Check:** Lines ~80-120 (compass grid), ~200-250 (log list)

### Practice Section

- **Component:** `PracticeSection.jsx` - Practice type selector
- **Likely Issues:** 4-column grid at narrow width, button text overflow
- **Check:** Lines ~1500-1600 (practice selector), ~1550-1580 (button grid)

- **Component:** `BreathConfig.jsx`, `SoundConfig.jsx`, etc. - Config panels
- **Likely Issues:** Fixed panel widths, preset button grids
- **Check:** Each config component's grid layout sections

### Wisdom Section

- **Component:** `CodexChamber.jsx` - Treatise browse grid
- **Likely Issues:** 3-column grid, card titles truncate
- **Check:** Lines ~100-200 (grid container), ~150-180 (card layout)

- **Component:** `VideoPlayer.jsx` - Video selection menu
- **Likely Issues:** Thumbnail grid too narrow, titles cut
- **Check:** Lines ~50-100 (grid), ~120-150 (video cards)

### Navigation Section

- **Component:** `PathSelectionGrid.jsx` - Path cards grid
- **Likely Issues:** 3-column grid at 320px, path names wrap badly
- **Check:** Lines ~30-80 (grid setup), ~100-150 (card rendering)

- **Component:** `ConsistencyFoundation.jsx` - Program cards grid
- **Likely Issues:** 2-column grid might be okay, but check title wrapping
- **Check:** Lines ~50-100 (program cards)

### Modals with Menus

- **Component:** `CurriculumOnboarding.jsx` - Time slot selection
- **Likely Issues:** Time slot grid, button wrapping
- **Check:** Lines ~150-200 (time grid)

- **Component:** `CycleChoiceModal.jsx` - Cycle type options
- **Likely Issues:** Option card grid, description text overflow
- **Check:** Lines ~80-150 (option cards)

---

## Implementation Handoff Checklist

### For Antigravity (Primary)

**⚠️ CRITICAL: Do Phase 1 ONLY first.**

Populate the Audit Table at 320px with component paths and failure modes **before any fixes**. This will either confirm the "Known Menu Surfaces" list or reveal misclassification/scope creep early.

**DO NOT proceed to Phase 2 until Phase 1 is complete and user has reviewed the Audit Table.**

---

**Phase 1: Audit (REQUIRED FIRST)**

- [ ] Set viewport to 320px width in Chrome DevTools
- [ ] Navigate to each section listed in "Known Menu Surfaces"
- [ ] **Verify each component is actually a menu surface** (per Menu Definition scope gate)
- [ ] Run overflow detection script (from Audit Plan Step 2)
- [ ] Fill out Audit Table with discovered failures
- [ ] Screenshot each failure for reference
- [ ] **Flag any non-menu components** in "Known Menu Surfaces" list as out-of-scope
- [ ] **Submit Audit Table to user for review before proceeding**

**Phase 2: Pattern Mapping (DO NOT START until Phase 1 approved)**

- [ ] Group failures by Pattern Classification (1-6)
- [ ] Identify reusable components causing multiple failures
- [ ] Note any failures NOT matching the 6 patterns (new pattern?)

**Phase 3: Fix Implementation**

- [ ] Apply guardrails to each component in priority order:
  1. Home Hub (most visible)
  2. Navigation Section (onboarding entry)
  3. Practice Section (frequent use)
  4. Application & Wisdom (secondary)
  5. Modals (less critical)
- [ ] Test each fix at 320px, 375px, 390px, and desktop
- [ ] Verify no regressions at larger widths

**Phase 4: Documentation**

- [ ] Update component files with pattern comments:
  ```jsx
  {/* MENU GUARDRAIL: 2-col grid at ≤360px (TASK-2026-01-05-D) */}
  <div className="grid grid-cols-2 sm:grid-cols-3 gap-4">
  ```
- [ ] Update WORKLOG.md with files modified and commit hash
- [ ] Note any patterns not covered by guardrails for future spec

---

### For Codex CLI (Assist if Needed)

**If Antigravity blocked or needs help:**

- [ ] Implement mechanical fixes (grid column changes, padding adjustments)
- [ ] Run automated overflow checks with scripts
- [ ] Update Tailwind config if new utilities needed (e.g., `safe-area-*`)

**DO NOT:**

- Refactor component architecture
- Change design system colors/fonts
- Modify state management

---

## Verification + Acceptance Criteria

### Manual Verification Steps

**1. Viewport Testing**

```
For each menu surface:
1. Set viewport to 320px width (DevTools or iPhone SE)
2. Navigate to the menu screen
3. Verify:
   ✓ All menu items visible (no horizontal overflow)
   ✓ All text readable (wrap allowed, no ellipsis before 2 lines)
   ✓ Cards/buttons fully in view (no vertical clipping)
   ✓ Bottom items have safe-area padding (if near bottom)
4. Repeat at 375px (iPhone 12/13 mini)
5. Repeat at 390px (iPhone 14)
6. Verify no regressions at 1080px (Hearth desktop)
```

**2. Overflow Detection**

```javascript
// Run in console at 320px on each menu screen
const checkOverflow = () => {
  const failures = [];

  // Check horizontal overflow (ignore canvas/decorative shadows)
  document.querySelectorAll("div, section, nav, button, a").forEach((el) => {
    if (el.scrollWidth > el.clientWidth + 1) {
      if (!el.querySelector("canvas") && !el.className.includes("glow")) {
        failures.push({
          type: "horizontal overflow",
          element: el,
          width: el.scrollWidth,
          containerWidth: el.clientWidth,
        });
      }
    }
  });

  // Check text truncation
  document.querySelectorAll("h1, h2, h3, h4, button, a").forEach((el) => {
    if (
      el.scrollWidth > el.clientWidth + 1 &&
      !el.classList.contains("truncate") &&
      !el.classList.contains("line-clamp-2")
    ) {
      failures.push({
        type: "text overflow (not intentional truncate)",
        element: el,
        text: el.textContent.trim(),
      });
    }
  });

  console.table(failures);
  return failures.length === 0;
};

checkOverflow();
```

**3. Safe-Area Testing**

- Use iOS Simulator or real device with home indicator
- Check bottom menus/navs don't overlap indicator
- Verify padding: `getComputedStyle(element).paddingBottom`

---

### Acceptance Criteria

**MUST PASS (Blockers):**

- [ ] **AC-1:** At 320px width, zero horizontal overflow on any menu surface (checked via `scrollWidth === clientWidth`)
- [ ] **AC-2:** At 320px width, all menu item titles readable without manual zoom
- [ ] **AC-3:** At 320px width, no menu cards/buttons clipped vertically (all content visible)
- [ ] **AC-4:** At 375px and 390px, all AC-1 through AC-3 still pass
- [ ] **AC-5:** At 1080px (Hearth desktop), no visual regressions from fixes

**SHOULD PASS (Nice-to-Have):**

- [ ] **AC-6:** Titles use 2-line clamp consistently across menus
- [ ] **AC-7:** Grid columns reduce to 2 at ≤360px (unless icon-only)
- [ ] **AC-8:** Bottom menus have safe-area padding on iOS devices
- [ ] **AC-9:** No fixed-height cards with variable text content

**DOCUMENTATION:**

- [ ] **AC-10:** WORKLOG.md updated with TASK ID, files modified, commit hash
- [ ] **AC-11:** Audit Table completed with all discovered failures
- [ ] **AC-12:** Guardrail patterns documented in component comments where applied

---

## Out of Scope

**Excluded from this task:**

- Content area text wrapping (articles, descriptions not in menus)
- Modal content clipping (non-menu modals like journals, reports)
- Practice session screens (BreathingRing, Vipassana session, etc.)
- Settings panels (unless they have menu-like option grids)
- Forms and input fields (separate accessibility task)

**Why excluded:** Focus on menu surfaces only. Other small-iPhone issues can be separate tasks (TASK-2026-01-05-E, etc.).

---

## Notes for Implementer

### Testing Tools

**Chrome DevTools:**

- Device toolbar: iPhone SE (320x568)
- Responsive mode: Custom 320px width
- Console: Run overflow detection script

**VS Code Extension:**

- "Browser Preview" for live testing
- Resize to 320px during development

**Real Device:**

- iPhone SE (1st/2nd/3rd gen) or iOS Simulator
- Test bottom safe-area specifically

### Common Pitfalls

1. **Fixing one width, breaking another:** Always test 320px, 375px, 390px, 1080px
2. **Over-constraining text:** Don't force single-line when 2-line is readable
3. **Removing height entirely:** Some cards need `min-height` for visual consistency
4. **Forgetting dark mode:** Check both light and dark color schemes
5. **Missing safe-area on Android:** Use `max()` not just `env()` for cross-platform

### Quick Wins

Start with these high-impact fixes:

1. Change all `grid-cols-3` to `grid-cols-2 sm:grid-cols-3` at ≤360px
2. Replace `truncate` with `line-clamp-2` on menu titles
3. Change all `h-32` to `min-h-32` on cards with text
4. Add `min-w-0` to all flex/grid children with `flex-1`

---

## Success Definition

**Task is DONE when:**

1. All menu surfaces pass AC-1 through AC-5 (MUST PASS criteria)
2. Audit Table completed and committed
3. WORKLOG.md updated with TASK-2026-01-05-D entry
4. No regressions at larger widths (verified manually)
5. Guardrail patterns applied consistently (noted in component comments)

**Not required for DONE:**

- Pixel-perfect design at all widths (functional is sufficient)
- Animations/transitions (can skip for speed)
- Accessibility beyond readability (separate task)
- Unit tests (manual verification acceptable)

---

## Commit Message Template

```
fix(ui): ensure all menus fit 320px width without clipping - TASK-2026-01-05-D

Applied menu-safe guardrails to fix small-iPhone layout issues.

Pattern fixes:
- Grid columns: 2-col at ≤360px (was 3-4 col)
- Text wrap: 2-line clamp on titles (was truncate/nowrap)
- Card heights: min-height not fixed height
- Flex children: added min-w-0 where needed
- Bottom padding: safe-area-inset for iOS home indicator
- Card widths: min(Xpx, 90vw) not fixed px

Components modified:
- [List components here, e.g., HomeHub.jsx, PathSelectionGrid.jsx]

Testing:
- ✓ All menus visible at 320px (no overflow)
- ✓ Titles readable (wrap allowed)
- ✓ No regressions at 375px, 390px, 1080px
- ✓ Bottom menus respect safe-area on iOS

Audit Table: [X] failures discovered, [X] fixed
See WORKLOG.md for detailed changes

Updates docs/WORKLOG.md (entry for TASK-2026-01-05-D)
```

---

## Mandatory Worklog Update

**File:** `docs/WORKLOG.md` (ALWAYS allowed per Worklog Exception Rule)

**Entry Format:**

```markdown
## 2026-01-05 [HH:MM] - Antigravity - COMPLETED

**Task**: TASK-2026-01-05-D - Hearth small-iPhone menu fit (no clipping)

**Files Modified**:

- `src/components/HomeHub.jsx` (grid 2-col at ≤360px, card width min())
- `src/components/PathSelectionGrid.jsx` (grid 2-col, title line-clamp-2)
- `src/components/FourModesHome.jsx` (button min-height, text wrap)
- `src/components/PracticeSection.jsx` (grid 2-col, width constraints)
- `src/components/CodexChamber.jsx` (grid 2-col, card heights)
- [List all modified components]

**Changes**:

- Applied 6 guardrail patterns to [X] menu surfaces
- Fixed [Y] instances of horizontal overflow at 320px
- Changed [Z] grids from 3-col to 2-col at ≤360px
- Replaced truncate with line-clamp-2 on [N] menu titles
- Added safe-area padding to bottom menus
- No regressions at larger widths verified

**Version**: v3.15.X (or next patch version)

**Status**: COMPLETED

**Commit**: [commit hash]

**Audit Summary**:

- Total menu surfaces audited: [X]
- Failures discovered: [Y]
- Patterns applied: All 6 guardrails
- Acceptance criteria: AC-1 through AC-5 PASS

**Notes**:

- All menus now fit 320px width without clipping
- Guardrail patterns documented in component comments
- Tested at 320px, 375px, 390px, 1080px
- Safe-area padding verified on iOS Simulator

---
```

**CRITICAL:** This worklog entry MUST be included in the SAME commit as the code changes.

---

## Questions for User (Optional - Answer Before Implementation)

1. **Priority order:** Start with Home Hub → Navigation → Practice, or different order?
2. **Design tolerance:** Okay if menu items wrap to 2 lines at 320px, or prefer smaller text?
3. **Safe-area strategy:** Use CSS `env(safe-area-inset-bottom)` or JS detection?
4. **Grid columns at 320px:** Always 2-col, or allow 3-col for icon-only menus?

---

## Appendix: Example Fixes

### Example 1: Path Selection Grid

**Before:**

```jsx
// src/components/PathSelectionGrid.jsx
<div className="grid grid-cols-3 gap-4">
  {paths.map((path) => (
    <div key={path.id} className="h-32 p-4">
      <h3 className="text-sm font-medium truncate">{path.name}</h3>
      <p className="text-xs">{path.description}</p>
    </div>
  ))}
</div>
```

**After:**

```jsx
// src/components/PathSelectionGrid.jsx
{
  /* MENU GUARDRAIL: 2-col grid at ≤360px (TASK-2026-01-05-D) */
}
<div className="grid grid-cols-2 sm:grid-cols-3 gap-4">
  {paths.map((path) => (
    <div key={path.id} className="min-h-32 min-w-0 p-4">
      {/* MENU GUARDRAIL: 2-line clamp (TASK-2026-01-05-D) */}
      <h3 className="text-sm font-medium line-clamp-2">{path.name}</h3>
      <p className="text-xs line-clamp-3">{path.description}</p>
    </div>
  ))}
</div>;
```

### Example 2: Home Hub Card Swiper

**Before:**

```jsx
// src/components/HomeHub.jsx
<div style={{ maxWidth: "430px", margin: "0 auto" }}>
  <div className="flex gap-4">
    {cards.map((card) => (
      <div
        key={card.id}
        className="h-40 flex-shrink-0"
        style={{ width: "430px" }}
      >
        {/* card content */}
      </div>
    ))}
  </div>
</div>
```

**After:**

```jsx
// src/components/HomeHub.jsx
{
  /* MENU GUARDRAIL: Viewport-relative width (TASK-2026-01-05-D) */
}
<div style={{ maxWidth: "min(430px, 90vw)", margin: "0 auto" }}>
  <div className="flex gap-4">
    {cards.map((card) => (
      <div
        key={card.id}
        className="min-h-40 flex-shrink-0 min-w-0"
        style={{ width: "100%", maxWidth: "min(430px, 90vw)" }}
      >
        {/* card content */}
      </div>
    ))}
  </div>
</div>;
```

### Example 3: Bottom Action Menu

**Before:**

```jsx
// src/components/SomeModal.jsx
<div className="fixed bottom-0 left-0 right-0 pb-4">
  <button>Continue</button>
</div>
```

**After:**

```jsx
// src/components/SomeModal.jsx
{
  /* MENU GUARDRAIL: Safe-area bottom padding (TASK-2026-01-05-D) */
}
<div
  className="fixed bottom-0 left-0 right-0"
  style={{ paddingBottom: "max(1rem, env(safe-area-inset-bottom))" }}
>
  <button>Continue</button>
</div>;
```
