# TASK-2026-01-05-A: ESLint Config/Tooling Fix

**Created:** 2026-01-05
**Recommended Executor:** Codex CLI
**Scope:** Bucket 1 only - Config/tooling `no-undef` errors
**Goal:** Reduce 458 errors by fixing only environment configuration issues

---

## Problem

ESLint is reporting `no-undef` errors for legitimate globals in config and tooling files:

1. **tailwind.config.js** (1 error)
   - `'module' is not defined` - CommonJS file needs Node.js globals

2. **tools/splitTreatise.js** (2 errors)
   - `'process' is not defined` - Node.js script needs Node.js globals

3. **src/hooks/useSessionInstrumentation.js** (2 errors)
   - `'process' is not defined` - Uses `process.env` for debug logging

**Total:** 5 errors from missing environment configuration

---

## Solution

Add proper environment globals to `eslint.config.js` using file-specific overrides.

---

## ALLOWLIST (Files to Modify)

1. `eslint.config.js` - Add environment-specific global configurations

---

## DENYLIST (Files NOT to Touch)

- **ALL files in `src/components/**`** - No UI changes
- **ALL files in `src/state/**`** - No state logic changes
- **ALL files in `src/services/**`** - No service changes
- Any file not explicitly in ALLOWLIST

---

## Implementation

### File: `eslint.config.js`

**Change:** Add three configuration blocks with appropriate globals

```javascript
export default defineConfig([
  globalIgnores(['dist']),

  // Base config for browser code
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },

  // Node.js config files (CommonJS)
  {
    files: ['*.config.js', '*.config.cjs'],
    languageOptions: {
      globals: {
        ...globals.node,
        module: 'readonly',
        require: 'readonly',
        __dirname: 'readonly',
        __filename: 'readonly',
      },
    },
  },

  // Node.js tools/scripts
  {
    files: ['tools/**/*.js'],
    languageOptions: {
      globals: {
        ...globals.node,
        process: 'readonly',
      },
    },
  },

  // Browser code that uses process.env (Vite injects this)
  {
    files: ['src/**/*.{js,jsx}'],
    languageOptions: {
      globals: {
        process: 'readonly', // Vite defines process.env
      },
    },
  },
])
```

**Rationale:**
- `tailwind.config.js` matches `*.config.js` → gets Node.js globals including `module`
- `tools/splitTreatise.js` matches `tools/**/*.js` → gets `process`
- `src/hooks/useSessionInstrumentation.js` matches `src/**/*.{js,jsx}` → gets `process` (Vite provides `process.env`)

---

## Constraints

1. **No refactors** - Only configuration changes
2. **No behavior changes** - Code logic untouched
3. **Minimal diff** - Single file modified
4. **No formatting** - Preserve existing style
5. **No component changes** - UI code completely untouched

---

## Verification

### Before
```bash
cd "D:\Unity Apps\immanence-os"
npm run lint 2>&1 | grep "✖"
```
**Expected:** `✖ 458 problems (433 errors, 25 warnings)`

### After
```bash
cd "D:\Unity Apps\immanence-os"
npm run lint 2>&1 | grep "✖"
```
**Expected:** `✖ 453 problems (428 errors, 25 warnings)` (5 fewer errors)

### Specific fixes verified
```bash
npm run lint 2>&1 | grep -E "(tailwind.config.js|tools/splitTreatise.js|useSessionInstrumentation.js)"
```
**Expected:** No `no-undef` errors for `module` or `process` in these files

---

## Commit Message

```
fix(eslint): add environment globals for config and tooling files

Fixes 5 no-undef errors in:
- tailwind.config.js (module)
- tools/splitTreatise.js (process)
- src/hooks/useSessionInstrumentation.js (process.env from Vite)

Added file-specific ESLint configs:
- *.config.js → Node.js globals (module, require, __dirname, etc.)
- tools/**/*.js → Node.js globals (process)
- src/**/*.{js,jsx} → Vite-injected globals (process.env)

No behavior changes. Config-only fix.

Reduces total from 458 → 453 errors (-5)
```

---

## Definition of DONE

- [ ] `eslint.config.js` updated with environment-specific configs
- [ ] Verification command shows 453 total errors (down from 458)
- [ ] No `no-undef` errors for `module` in `tailwind.config.js`
- [ ] No `no-undef` errors for `process` in `tools/splitTreatise.js`
- [ ] No `no-undef` errors for `process` in `src/hooks/useSessionInstrumentation.js`
- [ ] Changes committed with spec commit message
- [ ] No files in DENYLIST were modified
- [ ] No behavior changes introduced
